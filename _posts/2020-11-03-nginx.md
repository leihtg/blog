---
layout: post
title: nginx相关知识点
categories: guide
tags: guide nginx
author: leihtg
---





### 常用命令

```sh
nginx -s quit #等处理完请求后退出
kill -USR1 pid #向nginx主进程发送信号,用于重新打开日志文件
```



### location匹配规则

```nginx
location / {
    root html; #主目录
    index index.html; #默认主页
}
# 精确匹配
location = /a.png { 
    root /home;
}
#正则匹配 *代表不区分大小写
location ~* \.(GIF|png|bmp|jpg|jpeg) {
    root /home;
} 
# ^~ 以某个字符路径开头的请求
location ^~ /abc/img {
    root /home;
}
```



#### root 与 alias

假如服务器路径为：/home/imooc/files/img/face.png
		root 路径完全匹配访问 配置的时候为：

```nginx
location /imooc { 
    root /home 
} 
```

用户访问的时候请求为： url:port/imooc/files/img/face.png

alias 可以为你的路径做一个别名，对用户透明 配置的时候为：

```nginx
location /hello {
    root /home/imooc 
} 
```


用户访问的时候请求为： url:port/hello/files/img/face.png ，如此相当于为目录 imooc 做一个自定义的别名。



### 跨域配置

```nginx
server {
    
    #允许跨域请求的域，*代表所有 
    add_header 'Access-Control-Allow-Origin' *; 
    #允许带上cookie请求 
    add_header 'Access-Control-Allow-Credentials' 'true'; 
    #允许请求的方法，比如 GET/POST/PUT/DELETE
    add_header 'Access-Control-Allow-Methods' *; 
    #允许请求的header 
    add_header 'Access-Control-Allow-Headers' *; 
}
```

### 防盗链配置

```nginx
server {
    #对源站点难
    valid_referers *.abc.com;
    #非法引入会进入下方判断
    if($invalid_referer) {
        return 404;
    }
}
```



### Nginx的模块化体系

Nginx

* http
* mail
* nginx core
  * event module
  * phase handler
  * output filter
  * upstream
  * extend module



### 负载均衡

#### 四层负载均衡(转发TCP/HTTP)

* F5 硬件负载均衡
* LVS四层负载均衡
* Haproxy四层负载均衡
* Nginx四层负载均衡

#### 七层负载均衡(处理HTTP)

* Haproxy七层负载均衡
* Nginx七层负载均衡
* apache七层负载均衡

#### DNS地域负载均衡

* DNS服务器